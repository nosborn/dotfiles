#compdef _driftctl driftctl

function _driftctl {
  local -a commands

  _arguments -C \
    '--disable-telemetry[Disable telemetry]' \
    '(-h --help)'{-h,--help}'[Display help for command]' \
    '--no-version-check[Disable the version check]' \
    '--send-crash-report[Enable error reporting. Crash data will be sent to us via Sentry.
WARNING: may leak sensitive data (please read the documentation for more details)
This flag should be used only if an error occurs during execution]' \
    "1: :->cmnds" \
    "*::arg:->args"

  case $state in
  cmnds)
    commands=(
      "completion:Generate completion script"
      "gen-driftignore:Generate a .driftignore file based on your scan result"
      "help:Help about any command"
      "scan:Scan"
      "version:Display driftctl version"
    )
    _describe "command" commands
    ;;
  esac

  case "$words[1]" in
  completion)
    _driftctl_completion
    ;;
  gen-driftignore)
    _driftctl_gen-driftignore
    ;;
  help)
    _driftctl_help
    ;;
  scan)
    _driftctl_scan
    ;;
  version)
    _driftctl_version
    ;;
  esac
}

function _driftctl_completion {
  _arguments \
    '--disable-telemetry[Disable telemetry]' \
    '(-h --help)'{-h,--help}'[Display help for command]' \
    '--no-version-check[Disable the version check]' \
    '--send-crash-report[Enable error reporting. Crash data will be sent to us via Sentry.
WARNING: may leak sensitive data (please read the documentation for more details)
This flag should be used only if an error occurs during execution]' \
    '1: :("bash" "zsh" "fish" "powershell")'
}

function _driftctl_gen-driftignore {
  _arguments \
    '--exclude-changed[Exclude resources that changed on cloud provider]' \
    '--exclude-missing[Exclude missing resources]' \
    '--exclude-unmanaged[Exclude resources not managed by IaC]' \
    '(-i --input)'{-i,--input}'[Input where the JSON should be parsed from. Defaults to stdin.]:' \
    '(-o --output)'{-o,--output}'[Output file path to write the driftignore to.]:' \
    '--disable-telemetry[Disable telemetry]' \
    '(-h --help)'{-h,--help}'[Display help for command]' \
    '--no-version-check[Disable the version check]' \
    '--send-crash-report[Enable error reporting. Crash data will be sent to us via Sentry.
WARNING: may leak sensitive data (please read the documentation for more details)
This flag should be used only if an error occurs during execution]'
}

function _driftctl_help {
  _arguments \
    '--disable-telemetry[Disable telemetry]' \
    '(-h --help)'{-h,--help}'[Display help for command]' \
    '--no-version-check[Disable the version check]' \
    '--send-crash-report[Enable error reporting. Crash data will be sent to us via Sentry.
WARNING: may leak sensitive data (please read the documentation for more details)
This flag should be used only if an error occurs during execution]'
}

function _driftctl_scan {
  _arguments \
    '--azurerm-account-key[Azure storage account key for state backend.
]:' \
    '--azurerm-storage-account[Azure storage account name for state backend.
]:' \
    '--config-dir[Directory path that driftctl uses for configuration.
]:' \
    '--deep[EXPERIMENTAL: Enable deep mode
You should check the documentation for more details: https://docs.driftctl.com/deep-mode
]' \
    '--driftignore[Path to the driftignore file]:' \
    '*--filter[JMESPath expression to filter on
Examples :
  - Type == '\''aws_s3_bucket'\'' (will filter only s3 buckets)
  - Type =='\''aws_s3_bucket && Id != '\''my_bucket'\'' (excludes s3 bucket '\''my_bucket'\'')
  - Attr.Tags.Terraform == '\''true'\'' (include only resources that have Tag Terraform equal to '\''true'\'')
]:' \
    '(*-f *--from)'{\*-f,\*--from}'[IaC sources, by default try to find local terraform.tfstate file
Accepted schemes are: tfstate://,tfstate+s3://,tfstate+http://,tfstate+https://,tfstate+tfcloud://,tfstate+gs://,tfstate+azurerm://
]:' \
    '(-H --headers)'{-H,--headers}'[Use those HTTP headers to query the provided URL.
Only used with tfstate+http(s) backend for now.
]:' \
    '*--ignore[EXPERIMENTAL: Patterns to be used for ignoring resources
Example: *,!aws_s3* (everything but resources that are prefixed with aws_s3 are ignored)
When using this parameter the driftignore file is not processed
When using multiple instances of this argument, order will be respected]:' \
    '--only-managed[Report only what'\''s managed by your IaC
]' \
    '--only-unmanaged[Report only what'\''s not managed by your IaC
]' \
    '(*-o *--output)'{\*-o,\*--output}'[Output format, by default it will write to the console
Accepted formats are: console://,html://PATH/TO/FILE.html,json://PATH/TO/FILE.json,plan://PATH/TO/FILE.json
]:' \
    '--quiet[Do not display anything but scan results]' \
    '--strict[Includes cloud provider service-linked roles (disabled by default)]' \
    '--tf-lockfile[Terraform lock file to get the provider'\''s version from. Will be ignored if the file doesn'\''t exist.
]:' \
    '--tf-provider-version[Terraform provider version to use.
]:' \
    '--tfc-endpoint[Terraform Cloud / Enterprise API endpoint.
Only used with tfstate+tfcloud backend.
]:' \
    '--tfc-token[Terraform Cloud / Enterprise API token.
Only used with tfstate+tfcloud backend.
]:' \
    '(-t --to)'{-t,--to}'[Cloud provider source
Accepted values are: aws+tf,github+tf,gcp+tf,azure+tf
]:' \
    '--disable-telemetry[Disable telemetry]' \
    '(-h --help)'{-h,--help}'[Display help for command]' \
    '--no-version-check[Disable the version check]' \
    '--send-crash-report[Enable error reporting. Crash data will be sent to us via Sentry.
WARNING: may leak sensitive data (please read the documentation for more details)
This flag should be used only if an error occurs during execution]'
}

function _driftctl_version {
  _arguments \
    '--disable-telemetry[Disable telemetry]' \
    '(-h --help)'{-h,--help}'[Display help for command]' \
    '--no-version-check[Disable the version check]' \
    '--send-crash-report[Enable error reporting. Crash data will be sent to us via Sentry.
WARNING: may leak sensitive data (please read the documentation for more details)
This flag should be used only if an error occurs during execution]'
}
